フィルタの種類を三つに分けて考える。それらが適用されうる順序が色々ある。場合によっては、「絞り込み」か「やり直し」か、という選択肢が発生する。とりあえず全部列挙すると以下のとおり。


(1)	最初に文字数フィルタ
	すべての文を対象にする
	すべての文の文字数を記録する
	フィルタリング結果を真偽値で各文について記録する
	「直前のフィルタの種類」として「文字数」を記録する

(2)	最初に単語数フィルタ
	すべての文を対象にする
	すべての文の単語数を記録する
	フィルタリング結果を真偽値で各文について記録する
	「直前のフィルタの種類」として「単語数」を記録する

(3)	最初に一般フィルタ
	すべての文を対象にする
	条件に該当する文の「強調あり文字列」を記録する
	(該当しない文については空文字列を記録する?)
	フィルタリング結果を真偽値で各文について記録する
	「直前のフィルタの種類」として「一般」を記録する

(4)	文字数フィルタの直後に文字数フィルタ (意味的には単なるやり直しということ)
	すべての文を対象にする
	記録済みの文字数を使ってフィルタリングする
	フィルタリング結果を真偽値で各文について記録する
	「直前のフィルタの種類」として「文字数」を記録する

(5)	単語数フィルタの直後に単語数フィルタ (意味的には単なるやり直しということ)
	すべての文を対象にする
	記録済みの単語数を使ってフィルタリングする
	フィルタリング結果を真偽値で各文について記録する
	「直前のフィルタの種類」として「単語数」を記録する

(6)	文字数フィルタの直後に単語数フィルタ (ナンセンスだが生じうる事態ではある)
	すべての文を対象にする
	単語数が記録済みなら、その単語数の記録を使ってフィルタリングする
	未記録なら、フィルタリングのついでに、すべての文の単語数を記録する
	フィルタリング結果を真偽値で各文について記録する
	「直前のフィルタの種類」として「単語数」を記録する

(7)	単語数フィルタの直後に文字数フィルタ (ナンセンスだが生じうる事態ではある)
	すべての文を対象にする
	文字数が記録済みなら、その文字数の記録を使ってフィルタリングする
	未記録なら、フィルタリングのついでに、すべての文の文字数を記録する
	フィルタリング結果を真偽値で各文について記録する
	「直前のフィルタの種類」として「文字数」を記録する

(8)	文字数フィルタまたは単語数フィルタの直後に一般フィルタ、かつ、「絞り込み」指定
	直前のフィルタリング結果 (真偽値のフラグで判断) を対象にする
	該当する文の「強調あり文字列」を記録する
	(該当しない文については空文字列を記録する?)
	フィルタリング結果を真偽値で各文について記録する
	「直前のフィルタの種類」として「一般」を記録する

(9)	文字数フィルタまたは単語数フィルタの直後に一般フィルタ、かつ、「やり直し」指定
	すべての文を対象にする
	該当する文の「強調あり文字列」を記録する
	(該当しない文については空文字列を記録する?)
	フィルタリング結果を真偽値で各文について記録する
	「直前のフィルタの種類」として「一般」を記録する

(10)	一般フィルタの直後に文字数フィルタまたは単語数フィルタ、かつ、「絞り込み」指定
	直前のフィルタリング結果 (真偽値のフラグで判断) を対象にする
	文字数または単語数が記録済みなら、その記録を使ってフィルタリングする
	未記録なら、フィルタリングのついでに、すべての文の文字数または単語数を記録する
	フィルタリング結果を真偽値で各文について記録する
	「直前のフィルタの種類」を記録する

(11)	一般フィルタの直後に文字数フィルタまたは単語数フィルタ、かつ、「やり直し」指定
	すべての文を対象にする
	文字数または単語数が記録済みなら、その記録を使ってフィルタリングする
	未記録なら、フィルタリングのついでに、すべての文の文字数または単語数を記録する
	フィルタリング結果を真偽値で各文について記録する
	「直前のフィルタの種類」を記録する

(12)	一般フィルタの直後に一般フィルタ (意味的には別の課題に移るということなので、「やり直し」のみ考えることにし、「絞り込み」は考えない)
	すべての文を対象にする
	該当する文の「強調あり文字列」を記録する
	(該当しない文については空文字列を記録する?)
	フィルタリング結果を真偽値で各文について記録する
	「直前のフィルタの種類」として「一般」を記録する


以上を、「今呼ばれたフィルタ」の視点から分類し直すと、次のようになる。

(A)	今、文字数フィルタが呼ばれた
	(1), (4), (7), (10), (11) が該当。
	(1), (4), (7), (11) では、すべての文を対象とする。
	(10) のみ、直前のフィルタリング結果を対象とする。
	(10), (11) では「やり直し」と「絞り込み」を選択。

(B)	今、単語数フィルタが呼ばれた
	(2), (5), (6), (10), (11) が該当。
	(2), (5), (6), (11) では、すべての文を対象とする。
	(10) のみ、直前のフィルタリング結果を対象とする。
	(10), (11) では「やり直し」と「絞り込み」を選択。

(C)	今、一般フィルタが呼ばれた
	(3), (8), (9), (12) が該当。
	(3), (9), (12) では、すべての文を対象とする。
	(8) のみ、直前のフィルタリング結果を対象とする。
	(8), (9) では「やり直し」と「絞り込み」を選択。


あ、一般→文字数→文字数で、最初の文字数フィルタで「絞り込み」を選んでいると、2度目の文字数フィルタで更に絞り込みをしたいかもしれないな。そうすると(4)のようにしては駄目だ。単語数についても同様。よって、(4)〜(7)は、見直しが必要。
逆に、文字数→一般→一般の場合は、1度目の一般フィルタは「絞り込み」かもしれないが、2番目の一般フィルタは必ず「やり直し」なので、そういう問題は起きないはず。

